services:
  mwebsite:
    image: mwebsite-image:latest
    build: .       # if youâ€™re rebuilding the nginx image
    volumes:
      - ./:/usr/share/nginx/html
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - python-backend
    ports:
      - "9005:80"
    restart: unless-stopped
    networks: 
      - mwebsitepr
      - proxy
  python-backend:
    image: mwebsite-backend:latest    # build this from mwebsitepr.com/python-backend
    build: ./python-backend
    volumes:
      - ./python-backend/scripts:/app/scripts:ro
    environment:
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
      - CONTACT_EMAIL_TO=${CONTACT_EMAIL_TO}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - CONTACT_EMAIL_FROM=${CONTACT_EMAIL_FROM}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_USE_TLS=${SMTP_USE_TLS}
      - CONTACT_EMAIL_SUBJECT_PREFIX=${CONTACT_EMAIL_SUBJECT_PREFIX}
    networks:
      - mwebsitepr
    restart: unless-stopped

networks:
  mwebsitepr:
  proxy:
    external: true
